import{Signal as t}from"signal-polyfill";
/**
 * @license
 * Copyright 2023 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */let i=!1;const s=new t.subtle.Watcher(()=>{i||(i=!0,queueMicrotask(()=>{i=!1;for(const t of s.getPending())t.get();s.watch()}))}),h=Symbol("SignalWatcherBrand"),e=new FinalizationRegistry(i=>{i.unwatch(...t.subtle.introspectSources(i))}),n=new WeakMap;function o(i){return!0===i[h]?(console.warn("SignalWatcher should not be applied to the same class more than once."),i):class extends i{constructor(){super(...arguments),this._$St=new Map,this._$So=new t.State(0),this._$Si=!1}_$Sl(){var t,i;const s=[],h=[];this._$St.forEach((t,i)=>{((null==t?void 0:t.beforeUpdate)?s:h).push(i)});const e=null===(t=this.h)||void 0===t?void 0:t.getPending().filter(t=>t!==this._$Su&&!this._$St.has(t));s.forEach(t=>t.get()),null===(i=this._$Su)||void 0===i||i.get(),e.forEach(t=>t.get()),h.forEach(t=>t.get())}_$Sv(){this.isUpdatePending||queueMicrotask(()=>{this.isUpdatePending||this._$Sl()})}_$S_(){if(void 0!==this.h)return;this._$Su=new t.Computed(()=>{this._$So.get(),super.performUpdate()});const i=this.h=new t.subtle.Watcher(function(){const t=n.get(this);void 0!==t&&(!1===t._$Si&&(new Set(this.getPending()).has(t._$Su)?t.requestUpdate():t._$Sv()),this.watch())});n.set(i,this),e.register(this,i),i.watch(this._$Su),i.watch(...Array.from(this._$St).map(([t])=>t))}_$Sp(){if(void 0===this.h)return;let i=!1;this.h.unwatch(...t.subtle.introspectSources(this.h).filter(t=>{var s;const h=!0!==(null===(s=this._$St.get(t))||void 0===s?void 0:s.manualDispose);return h&&this._$St.delete(t),i||(i=!h),h})),i||(this._$Su=void 0,this.h=void 0,this._$St.clear())}updateEffect(i,s){var h;this._$S_();const e=new t.Computed(()=>{i()});return this.h.watch(e),this._$St.set(e,s),null!==(h=null==s?void 0:s.beforeUpdate)&&void 0!==h&&h?t.subtle.untrack(()=>e.get()):this.updateComplete.then(()=>t.subtle.untrack(()=>e.get())),()=>{this._$St.delete(e),this.h.unwatch(e),!1===this.isConnected&&this._$Sp()}}performUpdate(){this.isUpdatePending&&(this._$S_(),this._$Si=!0,this._$So.set(this._$So.get()+1),this._$Si=!1,this._$Sl())}connectedCallback(){super.connectedCallback(),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),queueMicrotask(()=>{!1===this.isConnected&&this._$Sp()})}}}export{o as SignalWatcher};
//# sourceMappingURL=signal-watcher.js.map
